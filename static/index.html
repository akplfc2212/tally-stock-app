<!DOCTYPE html>
<html>
<head>
  <title>Stock Check</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 420px;
      margin: auto;
      background: #f7f7f7;
    }

    h2 {
      text-align: center;
    }

    input, button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
    }

    button {
      background: #000;
      color: #fff;
      border: none;
      border-radius: 6px;
    }

    #result {
      margin-top: 15px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
    }

    img {
      margin-top: 15px;
      max-width: 100%;
      border-radius: 6px;
    }

    .error {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }

    .out {
      color: red;
      font-weight: bold;
    }

    .updated {
      font-size: 14px;
      color: gray;
      margin-top: 5px;
    }
  </style>
</head>

<body>

<h2>Check Stock</h2>

<input
  id="code"
  placeholder="Enter Item Code (e.g. FR-101)"
  oninput="this.value = this.value.toUpperCase()"
  onkeydown="if(event.key === 'Enter') checkStock()"
/>

<button onclick="checkStock()">Check</button>

<div id="result"></div>

<script>
function formatDate(isoString) {
  const d = new Date(isoString);

  const day = String(d.getDate()).padStart(2, '0');
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const year = d.getFullYear();

  const hours = String(d.getHours()).padStart(2, '0');
  const minutes = String(d.getMinutes()).padStart(2, '0');

  return `${day}/${month}/${year}, ${hours}:${minutes}`;
}

function checkStock() {
  const code = document.getElementById("code").value.trim();
  const result = document.getElementById("result");

  if (!code) {
    result.innerHTML = `<div class="error">Please enter an item code</div>`;
    return;
  }

  result.innerHTML = "Checking stock...";

  fetch(`/stock/${code}`)
    .then(res => res.json())
    .then(data => {
      if (data.error) {
        result.innerHTML = `<div class="error">Item not found</div>`;
      } else {
        const stockHtml = data.stock > 0
          ? `<p><b>Available Stock:</b> ${data.stock}</p>`
          : `<p class="out">Out of Stock</p>`;

        const updatedHtml = data.last_updated
          ? `<div class="updated">Last updated: ${formatDate(data.last_updated)}</div>`
          : "";

        result.innerHTML = `
          <h3>${data.name}</h3>
          ${stockHtml}
          ${updatedHtml}
          <img src="${data.image_url}">
        `;
      }
    })
    .catch(() => {
      result.innerHTML = `<div class="error">Server unreachable. Try again.</div>`;
    });
}
</script>

</body>
</html>
